#include<iostream>
#include<windows.h>
#include<ctime>
#include<cstdlib>
#include<conio.h>
#include<cstring>
using namespace std;
int m[26][26]={0};
int n,xx,yy,sx,sy;
bool mark[26][26]={0};
char bomb[26][26]={'0'};
char status[26][26];
int bbb[26][26]={0};
char choice;
void newworld(int x,int y);
void ar();
void lyl();
void judge();
void game();
void start();
void newworld(int x,int y)
{
	if(x-1<=0||y-1<=0||x+1>xx||y+1>yy) return;
	status[x][y]='0';
	if(m[x-1][y-1]==0) newworld(x-1,y-1),status[x-1][y-1]=m[x-1][y-1]+'0';else return;
	if(m[x-1][y]==0) newworld(x-1,y),status[x-1][y]=m[x-1][y]+'0';else return;
	if(m[x-1][y+1]==0) newworld(x-1,y+1),status[x-1][y+1]=m[x-1][y+1]+'0';else return;
	if(m[x][y-1]==0) newworld(x,y-1),status[x][y-1]=m[x][y-1]+'0';else return;
	if(m[x][y+1]==0) newworld(x,y+1),status[x][y+1]=m[x][y+1]+'0';else return;
	if(m[x+1][y-1]==0) newworld(x+1,y-1),status[x+1][y-1]=m[x+1][y-1]+'0';else return;
	if(m[x+1][y]==0) newworld(x+1,y),status[x+1][y]=m[x+1][y]+'0';else return;
	if(m[x+1][y+1]==0) newworld(x+1,y+1),status[x+1][y+1]=m[x+1][y+1]+'0';else return;
}
void ar()
{
	if(n>500) cin>>n,ar();
	else return;
}
void lyl()
{
	int x=rand()%xx+1,y=rand()%yy+1;
	if(mark[x][y]) lyl();
	else
	{
		m[x][y]=9,mark[x][y]=true;
		return;
	}
} //李云龙[滑稽] 
void judge()
{
	cin>>sx>>sy;
	if(sx<=0||sy<=0||sx>xx||sy>yy) cout<<"您?输了个什么东西?",system("cls"),judge();
	else return;
}
void start()
{
	for(int i=1;i<=xx;i++)
		for(int j=1;j<=yy;j++) status[i][j]='X';
	system("cls");
	while(1)
	{
		system("cls");
		for(int i=1;i<=xx;i++)
		{
			for(int j=1;j<=yy;j++) cout<<status[i][j]<<" ";
			cout<<endl;
		}
		bool con=true;
		judge();
		for(int i=1;i<=xx;i++)
			for(int j=1;i<=yy;j++) if(status[i][j]=='X') con=false;
		if(con)
		{
			cout<<"你赢了!"<<endl;
			cout<<"新游戏(n)还是退出(q)?"<<endl;
			char choice=getch();
			switch(choice)
			{
				case 'q':
				{
					cout<<"再见!";
					exit(0);
					break;
				}
				case 'n': game();break;
			}
		}
		if(m[sx][sy]==9)
		{
			cout<<"此时,一位名叫李云龙的人路过."<<endl;
			cout<<"开炮!开炮!开炮!"<<endl;
			cout<<R"(
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			00000000
			00000000
			00000000
			00000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			00000000
			00000000
			00000000
			00000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000



			000000000            000000000
			 000000000          000000000
			  000000000        000000000
			   000000000      000000000
			    000000000    000000000
			     000000000  000000000
			      000000000000000000
			      000000000000000000
			      000000000000000000
			      000000000000000000
			     000000000  000000000
			    000000000    000000000
			   000000000      000000000
			  000000000        000000000
			 000000000          000000000
			000000000            000000000




			000000000000000000000000000000000000
			000000000000000000000000000000000000
			000000000000000000000000000000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000000000000000000000000000000
			000000000000000000000000000000000000
			000000000000000000000000000000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000





			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000000000000000000000000000000
			000000000000000000000000000000000000
			000000000000000000000000000000000000
			000000000000000000000000000000000000




			000000000000000000000000000000000000
			000000000000000000000000000000000000
			000000000000000000000000000000000000
			000000000000000000000000000000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000000000000000000000000000000
			000000000000000000000000000000000000
			000000000000000000000000000000000000
			000000000000000000000000000000000000




			000000000000000000000000000000000000
			000000000000000000000000000000000000
			000000000000000000000000000000000000
			000000000000000000000000000000000000
			000000000                   000000000
			000000000                   000000000
			000000000                   000000000
			000000000                    000000000
			000000000                     000000000
			000000000                      000000000
			000000000                       000000000
			000000000                        000000000
			000000000                        000000000
			000000000                        000000000
			000000000                       000000000
			000000000                      000000000
			000000000                     000000000
			000000000                    000000000
			000000000                   000000000
			000000000                   000000000
			000000000                   000000000
			0000000000000000000000000000000000000
			0000000000000000000000000000000000000
			0000000000000000000000000000000000000






			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			00000000
			00000000
			00000000
			00000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			00000000
			00000000
			00000000
			00000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000





			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000



			000000000
			000000000
			000000000
			000000000
			000000000)"<<endl;
			Sleep(3000);
			cout<<"你被炸飞了."<<endl;
			cout<<"重玩(r),新游戏(n)还是退出(q)?"<<endl;
			choice=getch();
			switch(choice)
			{
				case 'q':
				{
					cout<<"再见!";
					exit(0);
					break;
				}
				case 'r': start();break;
				case 'n': game();break;
			}
		}
		else
		{
			if(m[sx][sy]==0) status[sx][sy]='0',newworld(sx,sy);
			else status[sx][sy]=m[sx][sy]+'0';
		}
	}
}
void game()
{
	srand(time(0));
	cin>>xx>>yy>>n;
	for(int i=1;i<=xx;i++)
		for(int j=1;j<=yy;j++) status[i][j]='X',cout<<status[i][j];
	ar();
	cout<<"正在生成..."<<endl;
	for(int i=1;i<=n;i++) lyl();
	for(int i=1;i<=xx;i++)
	{
		for(int j=1;j<=yy;j++)
		{
			cout<<"X";
			if(m[i][j]!=9) bomb[i][j]='X';
			else bomb[i][j]='O';
		}
		cout<<endl;
	}
	for(int i=1;i<=xx;i++)
		for(int j=1;j<=yy;j++)
		{
			if(bomb[i][j]=='O'||m[i][j]==9) continue;
			if(m[i-1][j-1]==9) m[i][j]++;
			if(m[i-1][j]==9) m[i][j]++;
			if(m[i-1][j+1]==9) m[i][j]++;
			if(m[i][j-1]==9) m[i][j]++;
			if(m[i][j+1]==9) m[i][j]++;
			if(m[i+1][j-1]==9) m[i][j]++;
			if(m[i+1][j]==9) m[i][j]++;
			if(m[i+1][j+1]==9) m[i][j]++;
		}
	for(int i=1;i<=xx;i++)
		for(int j=1;j<=yy;j++) bbb[i][j]=m[i][j];
	cout<<"完成!";
	Sleep(2000);
	system("cls");
	while(1)
	{
		system("cls");
		for(int i=1;i<=xx;i++)
		{
			for(int j=1;j<=yy;j++) cout<<m[i][j]<<" ";
			cout<<endl;
		}
		
		for(int i=1;i<=xx;i++)
		{
			for(int j=1;j<=yy;j++) cout<<status[i][j]<<" ";
			cout<<endl;
		}
		bool con=true;
		judge();
		bbb[sx][sy]=111;
		for(int i=1;i<=xx;i++)
			for(int j=1;j<=yy;j++) if(bbb[i][j]!=111&&bbb[i][j]!=9) con=false;
		if(con)
		{
			cout<<"你赢了!"<<endl;
			cout<<"新游戏(n)还是退出(q)?"<<endl;
			char choice=getch();
			switch(choice)
			{
				case 'q':
				{
					cout<<"再见!";
					exit(0);
					break;
				}
				case 'n': game();break;
			}
		}
		if(m[sx][sy]==9)
		{
			cout<<"此时,一位名叫李云龙的人路过."<<endl;
			cout<<"开炮!开炮!开炮!"<<endl;
			cout<<R"(0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			00000000
			00000000
			00000000
			00000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			00000000
			00000000
			00000000
			00000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000



			000000000            000000000
			 000000000          000000000
			  000000000        000000000
			   000000000      000000000
			    000000000    000000000
			     000000000  000000000
			      000000000000000000
			      000000000000000000
			      000000000000000000
			      000000000000000000
			     000000000  000000000
			    000000000    000000000
			   000000000      000000000
			  000000000        000000000
			 000000000          000000000
			000000000            000000000




			000000000000000000000000000000000000
			000000000000000000000000000000000000
			000000000000000000000000000000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000000000000000000000000000000
			000000000000000000000000000000000000
			000000000000000000000000000000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000





			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000000000000000000000000000000
			000000000000000000000000000000000000
			000000000000000000000000000000000000
			000000000000000000000000000000000000




			000000000000000000000000000000000000
			000000000000000000000000000000000000
			000000000000000000000000000000000000
			000000000000000000000000000000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000                  000000000
			000000000000000000000000000000000000
			000000000000000000000000000000000000
			000000000000000000000000000000000000
			000000000000000000000000000000000000




			000000000000000000000000000000000000
			000000000000000000000000000000000000
			000000000000000000000000000000000000
			000000000000000000000000000000000000
			000000000                   000000000
			000000000                   000000000
			000000000                   000000000
			000000000                    000000000
			000000000                     000000000
			000000000                      000000000
			000000000                       000000000
			000000000                        000000000
			000000000                        000000000
			000000000                        000000000
			000000000                       000000000
			000000000                      000000000
			000000000                     000000000
			000000000                    000000000
			000000000                   000000000
			000000000                   000000000
			000000000                   000000000
			0000000000000000000000000000000000000
			0000000000000000000000000000000000000
			0000000000000000000000000000000000000






			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			00000000
			00000000
			00000000
			00000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			00000000
			00000000
			00000000
			00000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000





			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000
			000000000



			000000000
			000000000
			000000000
			000000000
			000000000)"<<endl;
			Sleep(3000);
			cout<<"你被炸飞了."<<endl;
			cout<<"重玩(r),新游戏(n)还是退出(q)?"<<endl;
			choice=getch();
			switch(choice)
			{
				case 'q':
				{
					cout<<"再见!";
					exit(0);
					break;
				}
				case 'r':start();break;
				case 'n':game();break;
			}
		}
		else
		{
			if(m[sx][sy]==0) status[sx][sy]='0',newworld(sx,sy);
			else status[sx][sy]=m[sx][sy]+'0';
		}
	}
}

int main()
{
	game();
	return 0;
}
